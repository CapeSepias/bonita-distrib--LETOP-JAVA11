{"version":3,"sources":["js/generator.js","js/directives/pbDatepickerUtc.js","js/directives/pbModel.js","js/directives/pbPropertyValues.js","js/services/bindingsFactory.js","js/services/modelFactory.js"],"names":[],"mappings":"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","file":"generator.min.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular.module('org.bonitasoft.pagebuilder.generator.constants', []);\n  angular.module('org.bonitasoft.pagebuilder.generator.services', []);\n  angular.module('org.bonitasoft.pagebuilder.generator.directives', []);\n  angular.module('org.bonitasoft.pagebuilder.widgets', []);\n\n  angular.module('org.bonitasoft.pagebuilder.generator', [\n    'ngSanitize',\n    'org.bonitasoft.pagebuilder.generator.constants',\n    'org.bonitasoft.pagebuilder.generator.services',\n    'org.bonitasoft.pagebuilder.generator.directives',\n    'org.bonitasoft.pagebuilder.widgets'\n  ]);\n})();\n\n","(function () {\n  'use strict';\n\n  angular.module('org.bonitasoft.pagebuilder.generator.directives')\n    .directive('pbDatepickerUtc', function ($parse, $filter) {\n      function datepickerUtcLink(scope, element, attr, ngModelController) {\n\n          // called with a JavaScript Date object when picked from the datepicker\n          ngModelController.$parsers.push(function (viewValue) {\n            if (angular.isDate(viewValue)) {\n              viewValue.setMinutes(viewValue.getMinutes() - viewValue.getTimezoneOffset());\n            }\n            return viewValue;\n          });\n\n          // called with a 'yyyy-mm-dd' string to format\n          ngModelController.$formatters.push(function (modelValue) {\n            return $filter('date')( modelValue , attr.datepickerPopup);\n          });\n      }\n\n      return  {\n          restrict: 'A',\n          require:  'ngModel',\n          link: datepickerUtcLink\n      };\n\n    });\n})();\n","(function () {\n  'use strict';\n\n  angular.module('org.bonitasoft.pagebuilder.generator.directives')\n    .directive('pbModel', function ($parse, modelFactory, bindingsFactory, dataModelFactory) {\n\n      function PbModelCtrl() {}\n      PbModelCtrl.prototype.fill = function (rawData) {\n        var model = modelFactory.create(rawData);\n        this.createGateway = model.createGateway;\n        this.getModel = function() {\n          return model;\n        };\n      };\n\n      function pbModelCompile(tElement, tAttributes) {\n        var pbModelProperties = $parse(tAttributes.pbModelProperties)();\n        // avoid having angular interpolating property values as well\n        tElement.removeAttr(\"pbModelProperties\");\n\n        return {\n          pre: function (scope, element, attrs, pbModelCtrl) {\n            pbModelCtrl.fill(dataModelFactory.get(tAttributes.pbModel));\n            if(pbModelProperties && scope.$parent.pbModelCtrl) {\n              bindingsFactory.create(pbModelProperties, scope.$parent.pbModelCtrl.createGateway(), pbModelCtrl.getModel());\n            }\n          }\n        }\n      }\n\n      return {\n        restrict: 'A',\n        controller: PbModelCtrl,\n        // Expose controller to the scope to mask parent one.\n        // Every time a model is created then it mask its parent\n        // model allowing nested model\n        controllerAs: 'pbModelCtrl',\n        // This is why we use a new scope. To avoid overriding parent modelCtrl.\n        scope: true,\n        compile: pbModelCompile\n      }\n    });\n})();\n","(function () {\n  'use strict';\n\n  angular.module('org.bonitasoft.pagebuilder.generator.directives')\n    .directive('pbPropertyValues', function ($parse, bindingsFactory, propertyValuesFactory) {\n\n      function pbPropertyValuesCompile(tElement, tAttributes) {\n        return {\n          pre: function ($scope, elem, attr, pbModelCtrl) {\n            var context = pbModelCtrl.createGateway();\n            Object.defineProperty(context, '$item', {\n              get: function () {\n                return $scope.$item;\n              },\n              set: function (value) {\n                if ($scope.$collection) {\n                  $scope.$collection[$scope.$index] = value;\n                }\n              },\n              enumerable: true\n            });\n\n            Object.defineProperty(context, '$form', {\n              get: function () {\n                return $scope.$form;\n              },\n              set: function (value) {\n                $scope.$form = value;\n              },\n              enumerable: true\n            });\n\n            var pbPropertyValues = propertyValuesFactory.get(tAttributes.pbPropertyValues);\n            bindingsFactory.create(pbPropertyValues, context, $scope.properties = {});\n            $scope.properties.isBound = function (property) {\n              return !!(pbPropertyValues[property] && pbPropertyValues[property].type === 'data');\n            }\n          }\n        };\n      }\n\n      return {\n        restrict: 'A',\n        scope: true,\n        require: '^pbModel',\n        compile: pbPropertyValuesCompile\n      };\n    });\n})();\n","(function () {\n  'use strict';\n\n  /**\n   * Factory to create bindings associating properties (also known as properties) to the model.\n   *\n   * @param $interpolate\n   * @param $parse\n   * @param $log\n   * @returns {{create: createBindings}}\n   */\n  function bindingsFactory($interpolate, $parse, $log) {\n\n    /**\n     * Define destination properties allowing to\n     * access the context object as described in properties.\n     *\n     * @param properties - also known as properties. { type: <data | constant>, value: <expression> }\n     * @param context - against which property.value expression will be executed.\n     * @param destination - object where to bind the resulting properties.\n     */\n    function createBindings(properties, context, destination) {\n\n      /**\n       * Allow accessing a data in a two way data binding matter.\n       *\n       * @param property\n       * @returns {{get: Function, set: Function, enumerable: boolean}}\n       */\n      function createDataAccessors(property) {\n        var getter = $parse(property);\n        return {\n          get: function () {\n            return getter(context);\n          },\n          set: function (value) {\n            getter.assign(context, value);\n          },\n          enumerable: true\n        }\n      }\n\n      /**\n       * Allow accessing a constant using angular interpolation feature. Update the value back is not allowed.\n       *\n       * @param value\n       * @param name\n       * @returns {{get: Function, set: Function, enumerable: boolean}}\n       */\n      function createConstantAccessors(value, name) {\n        return {\n          get: function () {\n            return _.isString(value) ? $interpolate(String(value))(context) : value;\n          },\n          set: function () {\n            $log.warn('<', name, '> is a constant therefor it can\\'t be updated. Please bind a data instead.');\n          },\n          enumerable: true\n        }\n      }\n\n      var propertyAccessors = {\n        // We need two way data binding here.\n        'data': createDataAccessors,\n        // All constants are expressions candidate for interpolation.\n        // This is one way expression. We can't set an expression value back.\n        'constant': createConstantAccessors\n      };\n\n      Object.keys(properties).forEach(function (name) {\n        var property = properties[name];\n        Object.defineProperty(destination, name, propertyAccessors[property.type](property.value, name));\n      });\n    }\n\n    return {\n      create: createBindings\n    }\n  }\n\n  angular.module('org.bonitasoft.pagebuilder.generator.services')\n    .factory('bindingsFactory', bindingsFactory);\n})();\n","(function () {\n  'use strict';\n\n  function modelFactory($interpolate, $http, $log, $location) {\n\n    function resolveVariable(dataModel, descriptor, name) {\n      dataModel[name] = descriptor.value||undefined;\n    }\n\n    function resolveJson(dataModel, descriptor, name) {\n      dataModel[name] = JSON.parse(descriptor.value);\n    }\n\n    function resolveExpression(dataModel, descriptor, name) {\n\n      // use strict. Avoid pollution of the global object.\n      var expression = new Function('$data', '\"use strict\";' + descriptor.value);\n\n      Object.defineProperty(dataModel, name, {\n        get: function () {\n          try {\n            return expression(dataModel);\n          } catch (e) {\n            $log.warn(\"Error evaluating <\", name, \"> data: \", e.message);\n          }\n        },\n        enumerable: true\n      });\n    }\n\n    function resolveUrl(dataModel, descriptor, name) {\n\n      var url = null;\n      var value;\n\n      Object.defineProperty(dataModel, name, {\n        get: function () {\n          var currentUrl = $interpolate(descriptor.value, false, null, true)(dataModel);\n\n          if (currentUrl !== url && currentUrl !== undefined) {\n            url = currentUrl;\n            $http.get(url).success(function (data) {\n              value = data;\n            });\n          }\n          return value;\n        },\n        enumerable: true\n      });\n    }\n\n    function resolveUrlParameter(dataModel, descriptor, name) {\n      function extractUrlParameter(param, str) {\n        return decodeURI(str.replace(new RegExp(\"^(?:.*[&\\\\?]\" + encodeURI(param).replace(/[\\.\\+\\*]/g, \"\\\\$&\") + \"(?:\\\\=([^&]*))?)?.*$\", \"i\"), \"$1\"));\n      }\n\n      Object.defineProperty(dataModel, name, {\n        get: function () {\n          return extractUrlParameter(descriptor.value || '', $location.absUrl());\n        },\n        enumerable: true\n      });\n    }\n\n    return {\n      create: function (data) {\n        var model = _.transform(data, function (dataModel, descriptor, name) {\n          ({\n            variable: resolveVariable,\n            constant: resolveVariable,\n            json: resolveJson,\n            expression: resolveExpression,\n            url: resolveUrl,\n            urlparameter: resolveUrlParameter\n          }[descriptor.type] || angular.noop)(dataModel, descriptor, name);\n        });\n        model.createGateway = function () {\n          var context = {};\n          Object.keys(model).forEach(function (property) {\n            Object.defineProperty(context, property, {\n              get: function () {\n                return model[property];\n              },\n              set: function (value) {\n                model[property] = value;\n              },\n              enumerable: true\n            });\n          });\n          return context;\n        };\n        return model;\n      }\n    };\n  }\n\n  angular.module('org.bonitasoft.pagebuilder.generator.services')\n    .factory('modelFactory', modelFactory);\n})();\n"],"sourceRoot":"/source/"}