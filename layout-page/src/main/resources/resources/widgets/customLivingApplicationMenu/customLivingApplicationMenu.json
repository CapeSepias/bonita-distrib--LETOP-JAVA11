{"designerVersion":"1.0.0-SNAPSHOT","id":"customLivingApplicationMenu","name":"livingApplicationMenu","lastUpdate":1431437585271,"template":"<div class=\"navbar navbar-inverse\" role=\"navigation\">\n      <div class=\"container\">\n         <div class=\"container\">  \n\t\t\t<div class=\"navbar-header\">\n\t\t\t\t<a class=\"navbar-brand\">{{ctrl.applicationName}}</a>\n\t\t        <button type=\"button\" ng-init=\"navCollapsed = true\" ng-click=\"navCollapsed = !navCollapsed\" class=\"navbar-toggle\">\n                   <span class=\"icon-bar\"></span>\n                   <span class=\"icon-bar\"></span>\n                   <span class=\"icon-bar\"></span>\n                </button>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div collapse=\"navCollapsed\" class=\"collapse navbar-responsive-collapse navbar-collapse\">\n\t\t      <ul class=\"nav navbar-nav\">\n\t\t\t\t<li ng-class=\"{active:ctrl.pageToken===menu.applicationPageId.token}\" ng-repeat=\"menu in ctrl.applicationMenuList | filter:{parentMenuId:-1}\" dropdown>\n\t\t\t\t\t<a ng-if=\"!ctrl.isParentMenu(menu)\" ng-href=\"../{{menu.applicationPageId.token}}/\" >{{menu.displayName}}</a>            \n\t\t\t\t    <a ng-if=\"ctrl.isParentMenu(menu)\" dropdown-toggle>{{menu.displayName}}<span class=\"caret\"></span></a>\n\t\t\t\t    <ul ng-if=\"ctrl.isParentMenu(menu)\" class=\"dropdown-menu\">\n\t\t\t\t\t\t<li ng-repeat=\"childMenu in ctrl.applicationMenuList | filter:{parentMenuId:menu.id}\">\n\t\t\t\t\t\t\t<a ng-href=\"../{{childMenu.applicationPageId.token}}/\">{{childMenu.displayName}}</a>\n\t\t\t\t\t\t</li>\n\t\t\t\t    </ul>\n\t\t\t\t</li>\n\t\t\t   </ul>\n\t\t    </div>\n\t    </div>\n    </div>\n</div>\n","controller":"function WidgetlivingApplicationMenuController($scope, $http, $window) {\n    var ctrl = this;\n    \n    var pathArray = $window.location.pathname.split( '/' ); \n    ctrl.applicationToken =  pathArray[pathArray.length-3]; \n    ctrl.pageToken =  pathArray[pathArray.length-2];\n    \n\n    function getApplication() {\n        return $http.get('../API/living/application/?c=1&f=token%3D'+ctrl.applicationToken);\n    }\n   \n    function getApplicationMenuList(applicationId) {\n        \n        $http.get('../API/living/application-menu/?c=100&f=applicationId%3D'+applicationId+'&d=applicationPageId&o=menuIndex+ASC')\n            .success(function(data) { \n                ctrl.applicationMenuList = data;\n            });\n        return applicationId;\n    }\n\n    function setTargetedUrl() {\n        $scope.properties.targetUrl = $scope.properties.contextPath+\"/portal/resource/app/\"+ctrl.applicationToken+\"/\"+ ctrl.pageToken+\"/content/\"+ $window.location.search;\n    }\n\n    ctrl.isParentMenu= function(menu) {\n        return menu.parentMenuId==-1 && menu.applicationPageId==-1;\n    };\n    \n    getApplication().then(function(response) {\n        var application = response.data[0];\n        ctrl.applicationName = application.displayName;\n        return application.id;\n    }).then(getApplicationMenuList).then(setTargetedUrl);\n}","description":"This is an example of living application menu.","custom":true,"properties":[{"label":"URL targeted by the menu","name":"targetUrl","type":"text","bidirectional":false},{"label":"Bonita context path","name":"contextPath","type":"text","defaultValue":"/bonita","bidirectional":false}],"requiredModules":["ui.bootstrap"]}